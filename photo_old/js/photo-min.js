function toggleLoading(){var a=document.getElementById("loader");var b=a.style.visibility;if(b!="hidden"){a.style.visibility="hidden"}else{a.style.visibility="visible"}}function getURLParameter(a){return decodeURIComponent((new RegExp("[?|&]"+a+"=([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null}var w,h,numX,numY,sLen,startX,startY,imgData,c=document.getElementById("container"),p=document.getElementById("preview"),f=document.getElementById("fullscreen"),fi=document.getElementById("fullscreen_img"),header=document.getElementById("header"),currentPhotoNum=0,initPhotoNum=-1,previewSize=5;function init(){setVars();initTiles();setSizeAndPositions(true);setTileImgs();changeScreen();f.style.display="inline";header.style.display="inline"}function changeScreen(){setTimeout(function(){hideFullscreen();if(initPhotoNum!=-1&&initPhotoNum!=null){showFullscreen()}else{setSizeAndPositions()}},200)}function getImageInfo(){var b=document.createElement("canvas");var d=b.getContext("2d");var a=document.getElementById("mosaic_img");d.drawImage(a,0,0);imgData=d.getImageData(0,0,a.width,a.height)}function setVars(){w=window.innerWidth,h=window.innerHeight;numX=imgData.width,numY=imgData.height;sLen=Math.floor(Math.min(w/numX,h/numY));startX=(w-sLen*numX)/2,startY=(h-sLen*numY)/2;var a=parseInt(getURLParameter("n"));initPhotoNum=(a<photos.length&&a>=0)?a:-1;currentPhotoNum=(initPhotoNum!=-1)?initPhotoNum:currentPhotoNum}function initTiles(){for(var d=0;d<numY;d++){for(var b=0;b<numX;b++){var a=d*numX+b;if(imgData.data[a*4]+imgData.data[a*4+1]+imgData.data[a*4+2]<128&&imgData.data[a*4+3]>127){var e=document.createElement("div");e.className="tile";e.x=b;e.y=d;c.appendChild(e)}}}}function setSizeAndPositions(b){header.style.opacity="1";header.style.top=startY+"px";header.style.left=startX+"px";var a=document.getElementsByClassName("tile");if(b===true){orderRandom(a)}else{orderMosaic(a)}}function orderRandom(a){for(var b=0;b<a.length;b++){var d=a[b];d.style.width=sLen+"px";d.style.height=sLen+"px";d.style.transform="perspective(500px) translate3d("+(Math.random()*w-w)+"px,"+(Math.random()*h-h)+"px,"+1000+"px)";d.style.webkitTransform="perspective(500px) translate3d("+(Math.random()*w-w)+"px,"+(Math.random()*h-h)+"px,"+1000+"px)"}}function orderMosaic(a){for(var b=0;b<a.length;b++){var d=a[b];d.style.width=sLen+"px";d.style.height=sLen+"px";d.style.transform="perspective(500px) translate3d("+(startX+d.x*sLen)+"px,"+(startY+d.y*sLen)+"px,0px)";d.style.webkitTransform="perspective(500px) translate3d("+(startX+d.x*sLen)+"px,"+(startY+d.y*sLen)+"px,0px)"}}function setTileImgs(){var a=0;var b=document.getElementsByClassName("tile");for(var d=0;d<b.length;d++){var e=b[d];e.style.backgroundImage="url(photos/tiles/"+photos[a].file+")";e.photoId=a;e.fileName=photos[a].file;e.addEventListener("mouseover",function(){showPreview(this)});e.addEventListener("mouseout",function(){});if(a<photos.length-1){a++}else{a=0}}}function showPreview(a){p.style.backgroundImage="url(photos/tiles/"+a.fileName+")";p.style.width=previewSize*sLen+"px";p.style.height=previewSize*sLen+"px";show(p);p.style.left=(startX+a.x*sLen-(Math.ceil(previewSize/2)-1)*sLen)+"px";p.style.top=(startY+a.y*sLen-(Math.ceil(previewSize/2)-1)*sLen)+"px";currentPhotoNum=a.photoId;p.onmousemove=function(b){if(b.x<=(startX+a.x*sLen)||b.x>(startX+(a.x+1)*sLen)||b.y<=(startY+a.y*sLen)||b.y>(startY+(a.y+1)*sLen)){hide(p)}};p.onclick=function(){hide(p);pushHist("?n="+currentPhotoNum);showFullscreen()}}function showFullscreen(){p.style.opacity=0;updateSocial();var a=document.getElementsByClassName("tile");orderRandom(a);header.style.opacity="0";f.style.visibility="visible";f.style.opacity="1";fi.style.backgroundImage="url(photos/fullscreens/"+photos[currentPhotoNum].file+")";f.style.zIndex="5";fi.onclick=function(){updateFullscreen(1)};document.onkeydown=function(b){switch(b.keyCode){case 37:case 40:updateFullscreen(-1);break;case 39:case 38:updateFullscreen(1);break;case 27:updateFullscreen();break;default:break}};document.getElementById("prev").onclick=function(){updateFullscreen(-1)};document.getElementById("next").onclick=function(){updateFullscreen(1)};document.getElementById("quit").onclick=function(){updateFullscreen()}}function updateFullscreen(a){if(a<0){currentPhotoNum=currentPhotoNum+a>=0?currentPhotoNum+a:photos.length+a;fi.style.backgroundImage="url(photos/fullscreens/"+photos[currentPhotoNum].file+")";pushHist("?n="+currentPhotoNum);updateSocial()}else{if(a>0){currentPhotoNum=currentPhotoNum+a<=photos.length-1?currentPhotoNum+a:a-1;fi.style.backgroundImage="url(photos/fullscreens/"+photos[currentPhotoNum].file+")";pushHist("?n="+currentPhotoNum);updateSocial()}else{hideFullscreen();pushHist("?")}}}function updateSocial(){var i=encodeURIComponent(window.location.href);var d=encodeURIComponent("balint.us photography");var a=document.getElementById("facebook");a.onclick=function(){window.location="https://www.facebook.com/sharer/sharer.php?u="+i};var g=document.getElementById("twitter");g.onclick=function(){window.location="https://twitter.com/intent/tweet?url="+i+"&text="+d+"&hashtags=photography"};var j=document.getElementById("pinterest");j.onclick=function(){window.location="http://pinterest.com/pin/create/button/?url="+i+"&media="+encodeURIComponent("http://www.balint.us/photo/photos/previews/"+photos[currentPhotoNum].file)+"description="+d};var b=document.getElementById("google_plus");b.onclick=function(){window.location="https://plus.google.com/share?url="+i};var e=document.getElementById("buy");e.setAttribute("href",photos[currentPhotoNum].shoplocket.link);e.setAttribute("data-shoplocket-product-token",photos[currentPhotoNum].shoplocket.token);if(e.getAttribute("href")==""){e.style.display="none"}else{e.style.display="inline"}}function pushHist(a){window.history.pushState(null,null,a)}function hideFullscreen(){p.style.opacity=1;orderMosaic(document.getElementsByClassName("tile"));header.style.opacity="1";f.style.visibility="hidden";f.style.opacity="0";f.style.zIndex="-1"}function hide(a){a.style.display="none";a.style.visibility="hidden"}function show(a){a.style.display="inline";a.style.visibility="visible"}window.addEventListener("resize",function(){setVars();setSizeAndPositions();hide(p)},false);window.addEventListener("popstate",function(a){setVars();changeScreen()});window.onload=function(){getImageInfo();loadTileImages(function(){toggleLoading();init()})};function loadTileImages(e){var a=0;for(var d=0;d<photos.length;d++){var b=new Image();b.src="photos/tiles/"+photos[d].file;b.onload=function(){a++;if(a==photos.length-1){e()}}}};
